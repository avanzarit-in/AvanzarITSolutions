<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">

<body>
<div class="container-full" th:fragment="content">

    <div th:if="${message != null}" class="alert alert-success" id="success-alert">
        <strong>Success!</strong> <span th:text="${message}"/>
    </div>
    <div th:if="${error != null}" class="alert alert-danger" id="failure-alert">
        <strong>Error!</strong> <span th:text="${error}"/>
    </div>
    <form id="viewVendorDetailsForm" th:action="@{/action}" class="form-horizontal" method="post">
        <div class="panel panel-default">
            <div class="panel-heading">My Work List&nbsp;&nbsp;&nbsp;&nbsp;
                <label class="radio-inline"><input checked="checked" type="radio" value="1" name="filter"/>Show All</label>
                &nbsp;&nbsp;&nbsp;&nbsp;<label class="radio-inline"><input type="radio" value="2" name="filter"/>My Items</label>
                <a class="btn btn-primary" data-toggle="modal" style="float:right"  data-target="#myModal">Create New Vendor</a>
            </div>

            <div class="panel-body">
                <div class="row view-area">
                    <table id="dataTable" class="table table-hover table-striped table-bordered">
                        <thead class="thead-inverse">
                        <tr>
                            <th>Workflow&nbsp;Item&nbsp;ID</th>
                            <th>Vendor&nbsp;ID</th>
                            <th>Vendor&nbsp;Name</th>
                            <th>Telephone&nbsp;Extn</th>
                            <th>Email</th>
                            <th>Address</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="mItem : ${items}">

                            <td><label type="text"
                                       th:text="${mItem.changeRequestId}" /></td>
                            <td><a th:href="@{'/{context}/get/{workflowId}/{paramsKey}'(context=${context},workflowId=${mItem.changeRequestId},paramsKey=${mItem.vendor.vendorId})}"
                                   th:text="${mItem.vendor.vendorId}"/></td>
                            <td><label type="text"
                                       th:text="${mItem.vendor.vendorName1}" /></td>
                            <td><label type="text"
                                       th:text="${mItem.vendor.telephoneNumberExtn}" /></td>
                            <td><label type="text"
                                       th:text="${mItem.vendor.email}" /></td>
                            <td><label type="text"
                                       th:text="${mItem.vendor.address1}" /></td>
                            <td>
<div>
                                <a class="btn btn-primary" id="claimButton"  th:attr="data-workflowId=${mItem.changeRequestId}"
                                        th:if="*{#strings.toString(mItem.assignedUser) == null}">Claim
                                    </a>
                                <a class="btn btn-primary"  id="reassignButton" th:attr="data-vendorId=${mItem.vendor.vendorId}"
                                   th:if="*{#strings.toString(mItem.assignedUser) == #authentication.principal.username}">ReAssign
                                </a>
</div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
        <input type="hidden" name="vendorId" id="vendorId"/>
        <input type="hidden" name="action" id="action"/>

    </form>


    <!-- Modal -->
    <div id="myModal" class="modal fade" role="dialog">
        <div th:replace="fragments/vendorForm/createNewVendor :: createVendorForm">
            Workflow Dialogue
        </div>
     </div>
</div>

</body>
<script th:fragment="js" th:inline="javascript">
   $(document).ready(function () {
    $("#success-alert").fadeTo(2000, 500).slideUp(500, function () {
        $("#success-alert").slideUp(500);
    });
    $("#failure-alert").fadeTo(2000, 500).slideUp(500, function () {
        $("#failure-alert").slideUp(500);
    });

    $('#viewVendorDetailsForm').on('click', '#claimButton', function () {
        var $row = $(this)
            , index = $row.attr('data-workflowId');
        alert(index);
        $('#viewVendorDetailsForm').attr('action', 'claim/' + index);
        $('#viewVendorDetailsForm').submit();
    });
});

</script>
</html>
