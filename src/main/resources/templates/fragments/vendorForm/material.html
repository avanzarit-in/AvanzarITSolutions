<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<body>
<div  th:fragment="material" th:object="${vendor}">

    <div class="form-group" th:each="row,rowStat : *{materialMaster}"
         th:attr="data-materialMaster-index=${rowStat.index}">
        <label th:if="${rowStat.index}==0" class="col-xs-1 control-label">Material</label>
        <input type="hidden" class="form-control" th:field="*{materialMaster[__${rowStat.index}__].id}"/>
        <div class="col-xs-4" th:classappend="${rowStat.index}>0 ? col-xs-offset-1 : col-xs-offset-0">
            <input type="text" class="form-control" th:field="*{materialMaster[__${rowStat.index}__].code}"
                   placeholder="Material Code" th:disabled="*{submityn == 'Y'}"/>
        </div>
        <div class="col-xs-4">
            <input type="text" class="form-control" th:field="*{materialMaster[__${rowStat.index}__].desc}"
                   placeholder="Material Description" th:disabled="*{submityn == 'Y'}"/>
        </div>
        <div class="col-xs-2">
            <input type="text" class="form-control" th:field="*{materialMaster[__${rowStat.index}__].hsn}"
                   placeholder="HSN Code" th:disabled="*{submityn == 'Y'}"/>
        </div>
        <div class="col-xs-1">
            <button type="button" th:disabled="*{submityn == 'Y'}" class="btn btn-default" th:classappend="${rowStat.index}==0 ? addButton : removeButton">
                <i class="fa" th:classappend="${rowStat.index}==0 ? fa-plus : fa-minus"></i></button>
        </div>
    </div>

    <!-- The template for adding new field -->
    <div class="form-group hide" id="materailTemplate">
        <div class="col-xs-4 col-xs-offset-1">
            <input type="text" class="form-control" name="code" placeholder="Material Code" />
        </div>
        <div class="col-xs-4">
            <input type="text" class="form-control" name="desc" placeholder="Material Description" />
        </div>
        <div class="col-xs-2">
            <input type="text" class="form-control" name="hsn" placeholder="HSN Code" />
        </div>
        <div class="col-xs-1">
            <button type="button" th:disabled="*{submityn == 'Y'}" class="btn btn-default removeButton"><i class="fa fa-minus"></i></button>
        </div>
    </div>

</div>
</body>

<script th:fragment="materialjs"  th:inline="javascript">

$(document).ready(function() {

var codeValidators = {
            row: '.col-xs-4',
            validators: {
                stringLength: {
                        max: 50,
                        message: 'This field must be less than 50 characters'
                    }
            }
        },
        descValidators = {
            row: '.col-xs-4',
            validators: {
                stringLength: {
                        max: 50,
                        message: 'This field must be less than 50 characters'
                    }
            }
        },
        hsnValidators = {
            row: '.col-xs-2',
            validators: {
                stringLength: {
                        max: 50,
                        message: 'This field must be less than 50 characters'
                    }
            }
        },
        /*<![CDATA[*/
            materialIndex = [[${#lists.size(vendor.materialMaster)-1}]];
       /*]]>*/

         $('#material-tab')
        .formValidation({
            framework: 'bootstrap',
             excluded: [':disabled'],
            icon: {
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            fields: {

            }
        }).on('err.field.fv', function(e, data) {
             // data.element --> The field element
            var $tabPane = data.element.parents('.tab-pane'),
                tabId    = $tabPane.attr('id');
            $('a[href="#' + tabId + '"][data-toggle="tab"]')
                .parent()
                .find('i')
                 .removeClass('fa-check')
                .addClass('fa-times');
        }).on('success.field.fv', function(e, data) {
            // data.fv      --> The FormValidation instance
            // data.element --> The field element

            var $tabPane = data.element.parents('.tab-pane'),
                tabId    = $tabPane.attr('id'),
                $icon    = $('a[href="#' + tabId + '"][data-toggle="tab"]')
                            .parent()
                            .find('i')
                            .removeClass('fa-check fa-times');

            // Check if all fields in tab are valid
            var isValidTab = data.fv.isValidContainer($tabPane);
            if (isValidTab !== null) {
                $icon.addClass(isValidTab ? '' : 'fa-times');
            }
        });

 /*<![CDATA[*/
                for(index=0; index<=materialIndex; index++){

                $('#material-tab').formValidation('addField', 'materialMaster[' + index + '].code', codeValidators);
                $('#material-tab').formValidation('addField', 'materialMaster[' + index + '].desc', descValidators);
                $('#material-tab').formValidation('addField', 'materialMaster[' + index + '].hsn', hsnValidators);
        }
  /*]]>*/

        // Add button click handler
        $('#material-tab').on('click', '.addButton', function() {
            materialIndex++;

            var $template = $('#materailTemplate'),
                $clone    = $template
                                .clone()
                                .removeClass('hide')
                                .removeAttr('id')
                                .attr('data-materialMaster-index', materialIndex)
                                .insertBefore($template);

            // Update the name attributes
            $clone
                .find('[name="code"]').attr('name', 'materialMaster[' + materialIndex + '].code').attr('id', 'materialMaster' + materialIndex + '.code').end()
                .find('[name="desc"]').attr('name', 'materialMaster[' + materialIndex + '].desc').end()
                .find('[name="hsn"]').attr('name', 'materialMaster[' + materialIndex + '].hsn').end();

            // Add new fields
            // Note that we also pass the validator rules for new field as the third parameter
            $('#material-tab')
                .formValidation('addField', 'materialMaster[' + materialIndex + '].code', codeValidators)
                .formValidation('addField', 'materialMaster[' + materialIndex + '].desc', descValidators)
                .formValidation('addField', 'materialMaster[' + materialIndex + '].hsn', hsnValidators);
        });

        // Remove button click handler
        $('#material-tab').on('click', '.removeButton', function() {
            var $row  = $(this).parents('.form-group'),
                index = $row.attr('data-materialMaster-index');

            // Remove fields
            $('#material-tab')
                .formValidation('removeField', $row.find('[name="materialMaster[' + index + '].code"]'))
                .formValidation('removeField', $row.find('[name="materialMaster[' + index + '].desc"]'))
                .formValidation('removeField', $row.find('[name="materialMaster[' + index + '].hsn"]'));

            // Remove element containing the fields
            $row.remove();
        });

});
</script>
</html>